function shadowenv
  if test "$argv[1]" = "diff"
    "@SELF@" $argv "$__shadowenv_data"
  else
    "@SELF@" $argv
  end
end

function __shadowenv_hook --on-event fish_prompt --on-variable PWD
  @SELF@ hook --fish "$__shadowenv_data" \
    | while read line
      eval "$line" 2>/dev/null
    end
end
